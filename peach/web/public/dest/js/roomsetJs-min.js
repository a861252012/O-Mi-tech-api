/*! cross - v0.1.2 - 2018-02-05 */$(function(){var a=loopOptions({startNum:0,endNum:23});$("select[name='hour']").append(a);var b=loopOptions({startNum:0,endNum:59,interval:5});$("select[name='minute']").append(b);var c=loopOptions({startNum:25,endNum:55,interval:30});$("#oneToOne").find("select[name='duration']").append(c);var c=loopOptions({startNum:20,endNum:60,interval:5});$("#onToMore").find("select[name='duration']").append(c);var d=loopOptions({startNum:2e3,endNum:1e4,interval:1e3});$("select[name='select-points']").append(d),$("#rPwdRadioOpen").on("click",function(){$(".J-pwd-form").removeClass("none")}),$("#rPwdRadioClose").on("click",function(){$(".J-pwd-form").addClass("none")}),$("#btnChangePW").on("click",function(){$("#rPwd").trigger("keyup"),$("#rPwdTips").text().length>0&&"true"==$("[name='room-radio']:checked").val()||$.ajax({url:"/member/roomSetPwd",dataType:"json",type:"POST",data:{password:$("#rPwd").val(),"room-radio":$("[name='room-radio']:checked").val()},success:function(a){1==a.code?$.tips(a.msg):$.tips(a.msg)},error:function(a,b){window.console}})}),$(".J-onetoone-label").on("click",function(){var a=$(this).find('[type="radio"]');$(this).data("type");a.prop("checked",!0),$("#radioSelectPoints").is(":checked")?($("#oneToOne").find('select[name="select-points"]').prop("disabled",!1),$("#oneToOne").find('input[name="input-points"]').prop("disabled",!0)):($("#oneToOne").find('select[name="select-points"]').prop("disabled",!0),$("#oneToOne").find('input[name="input-points"]').prop("disabled",!1))}),$("#btnOneToOne").on("click",function(){var a=$("#oneToOne").find("input[name='mintime']").val(),b=$("#oneToOne").find("select[name='hour']").val(),c=$("#oneToOne").find("select[name='minute']").val();if(!$.trim(a).length)return void $.tips("请选择开播日期。");var d=a.split("-"),e=new Date(parseInt(d[0],10),parseInt(d[1],10)-1,parseInt(d[2],10),b,c);if(e.getTime()<Date.now())return void $.tips("不能设置过去的时间。");var f="",g="";if($("#radioSelectPoints").is(":checked"))f=$("#oneToOne").find("select[name='select-points']").val(),g="";else if(f="",g=$("#oneToOne").find("input[name='input-points']").val(),Number(g)<=1e4)return void $.tips("手动输入值必须大于10000");$.ajax({url:"/member/roomSetDuration",dataType:"json",type:"GET",data:{tid:4,mintime:a,hour:$("#oneToOne").find("select[name='hour']").val(),minute:$("#oneToOne").find("select[name='minute']").val(),duration:$("#oneToOne").find("select[name='duration']").val(),"select-points":f,"input-points":g},success:function(a){1==a.code?$.tips("预约房间（一对一）添加成功！",function(){location.reload()}):$.tips(a.msg)},error:function(a,b){window.console}})}),$("#btnOneToMore").on("click",function(){var a=$("#onToMore").find("input[name='mintime']").val(),b=$("#onToMore").find("select[name='hour']").val(),c=$("#onToMore").find("select[name='minute']").val();if(!$.trim(a).length)return void $.tips("请选择开播日期。");var d=a.split("-"),e=new Date(parseInt(d[0],10),parseInt(d[1],10)-1,parseInt(d[2],10),b,c);if(e.getTime()<Date.now())return void $.tips("不能设置过去的时间。");var f=Number($("#onToMore").find("input[name='points']").val());return Validation.isPositiveInteger(f)?f<300?void $.tips("单场最低价不能低于300钻石"):void $.ajax({url:"/member/roomOneToMore",dataType:"json",type:"GET",data:{tid:4,mintime:a,hour:$("#onToMore").find("select[name='hour']").val(),minute:$("#onToMore").find("select[name='minute']").val(),duration:$("#onToMore").find("select[name='duration']").val(),points:f},success:function(a){1==a.code?$.tips("预约房间（一对多）添加成功！",function(){location.reload()}):$.tips(a.msg)},error:function(a,b){window.console}}):void $.tips("请输入正确的钻石数。")}),$("#btnTimeCount").on("click",function(){var a=Number($("#timeCount").val());return Validation.isPositiveInteger(a)?void $.ajax({url:"/member/roomSetTimecost",data:{timecost:a},dataType:"json",type:"POST",success:function(a){1==a.code?$.tips("设置成功！"):$.tips(a.msg)},error:function(){}}):void $.tips("请输入一个数值！")}),$("#roomSetList-one").on("click",".btn-reserve-delete",function(){var a=$(this);$.ajax({url:"/member/delRoomDuration",data:{rid:$(this).data("roomid")},type:"GET",success:function(b){1==b.code?(a.closest("tr").remove(),$.tips("删除成功！")):$.tips(b.msg)}})}),$("#roomSetList-many").on("click",".btn-reserve-delete",function(){var a=$(this);$.ajax({url:"/member/delRoomOne2Many",data:{rid:$(this).data("roomid")},type:"GET",success:function(b){1==b.code?(a.closest("tr").remove(),$.tips("删除成功！")):$.tips(b.msg)}})}),$("#roomSetList-one").on("click",".btn-reserve-modify",function(){var a="<div class='m-form dialogRoomModify'><div class='m-form-item'><label for='resIptDate'>预约日期：</label><input id=\"resIptDate\" class=\"Wdate txt txt-s\" type=\"text\" onclick=\"WdatePicker()\" value=\"\"></div><div class='m-form-item'><label for='resSelectHour'>预约时间：</label><select id='resSelectHour'></select> : <select id='resSelectMinute'></select></div><div class='m-form-item'><label for='resSelectDuration'>预约时长：</label><select id='resSelectDuration'></select></div><div class='m-form-item'><label for='resSelectPoints'>钻石数量：</label><select id='resSelectPoints'></select></div></div>",b=$(this);$.dialog({title:"修改房间设置",content:a,onshow:function(){for(var a="",c=0;c<24;c++)a=c<10?a+"<option>0"+c+"</option>":a+"<option>"+c+"</option>";var d=loopOptions({startNum:0,endNum:23});$("#resSelectHour").append(d);var e=loopOptions({startNum:0,endNum:59,interval:5});$("#resSelectMinute").append(e);var f=loopOptions({startNum:25,endNum:55,interval:30});$("#resSelectDuration").append(f);var g=loopOptions({startNum:4e3,endNum:1e4,interval:1e3});$("#resSelectPoints").append(g);var h=b.closest("tr").find("td"),i=h.eq(1).text().split(" ")[0],j=h.eq(2).text(),k=h.eq(3).text(),l=h.eq(1).text().split(" ")[1].split(":")[0],m=h.eq(1).text().split(" ")[1].split(":")[1],n=$(".dialogRoomModify");n.find("#resIptDate").val(i),n.find("#resSelectHour").val(l),n.find("#resSelectMinute").val(m),n.find("#resSelectPoints").val(k),n.find("#resSelectDuration").val(j)},ok:function(){$.ajax({url:"/member/roomUpdateDuration",data:{durationid:b.data("roomid"),mintime:$("#resIptDate").val(),hour:$("#resSelectHour").val(),minute:$("#resSelectMinute").val(),points:$("#resSelectPoints").val(),duration:$("#resSelectDuration").val()},type:"GET",success:function(a){1==a.code?$.tips("修改成功！"):$.tips(a.msg)},error:function(a){}})},okValue:"确定",cancel:function(){},cancelValue:"取消"}).show()});var e=function(a){return $.dialog({id:"checkUserDetails",title:"查看详情",content:['<table border="1" class="table" id="showDetailsTable">',"<tr>","<th>创建时间</th>","<th>一对多开始时间</th>","<th>一对多结束时间</th>","<th>预约会员ID</th>","<th>预约会员昵称</th>","<th>付款时间</th>","<th>消费钻石数</th>","</tr>","</table>"].join(""),fixed:!1,height:"300px",onshow:function(){$("#checkUserDetails .d-bottom").hide(),$.ajax({url:"/member/getBuyOneToMore",dataType:"json",type:"GET",data:{onetomore:a},success:function(a){for(var b in a.msg){var c="<tr><td>"+a.msg[b].created+"</td><td>"+a.msg[b].starttime+"</td><td>"+a.msg[b].endtime+"</td><td>"+a.msg[b].uid+"</td><td>"+a.msg[b].nickname+"</td><td>"+a.msg[b].created+"</td><td>"+a.msg[b].points+"</td>NaN";$("#showDetailsTable").append(c)}},error:function(){}})}})};$("#roomSetList-many").on("click",".check-details",function(){var a=$(this).data("roomid");e(a).show()}),$("#rPwd").passwordInput("#rPwdTips")});