/*! cross - v0.1.2 - 2018-02-05 */var rankPanelTmp=['<div class="personContent-top clearfix">','<img class="personImg" src="#{headimg}" alt="" />','<div class="per-content">','<div class="per-content-title" clearfix">','<span class="per-name">#{nickname}</span>',"</div>",'<div class="per-hostid">#{hostId}</div>','<div class="per-icon">',"#{badge}","#{lvRich}","#{richMark}","</div>",'<div class="per-des">#{description}</div>',"</div>","</div>",'<div class="personContent-middle clearfix">','<span class="per-info">#{sex} | #{age} | #{starname} | #{procity}</span>',"#{isLive}",'<a href="#{space_url}" target="_blank" class="personLink">TA的空间</a>',"</div>",'<div class="personContent-bottom clearfix">','<div class="per-handle">',"#{attention}","</div>",'<a href="#{room_url}/#{rid}/h5" target="_blank" class="btn btn-red per-video-btn">进入房间</a>',"</div>"].join(""),favoriteHandle=function(a){var b=a.target.find(".per-fav-btn"),c=b.find("span");parseInt(a.checkatten,10)?(c.text("已关注"),b.data("fav","1")):(c.text("关注"),b.data("fav","0")),favoriteBtnSub(a)},favoriteBtnSub=function(a){var b,c=a.target.find(".per-fav-btn"),d=c.find("span");c.on("click",function(){var e=parseInt(c.data("fav"),10),f=1;return f=0==e?1:2,User.isLogin()?(b&&4!=b.readyState&&b.abort(),void(b=$.ajax({url:"/focus",type:"GET",dataType:"json",data:{pid:a.uid,ret:f},success:function(a){1==a.status?e?(d.text("关注"),c.data("fav","0")):(d.text("已关注"),c.data("fav","1"),User.flashUserInfo()):$.tips(a.msg)},error:function(a){}}))):void alert("请登录后再关注")})},getPanelData=function(a,b){a.find(".panel-hover").off("click"),a.on("mouseenter",".panel-hover",function(){var a=this;$(a).find(".personContent-top").length||$.ajax({type:"GET",url:"/majax/getfidinfo",data:{uid:$(a).attr("rel"),atten:!0},dataType:"json",success:function(c){if(c.ret){if(0==c.info.sex?c.info.sex="女":c.info.sex="男",3==c.info.roled?(c.info.hostId="(主播ID："+c.info.uid+")",c.info.richMark='<span class="hotListImg AnchorLevel'+c.info.lv_exp+'"></span>',c.info.lvRich=""):(c.info.hostId="",c.info.richMark="",c.info.lvRich=""),c.info.badge=0==c.info.vip?0==c.info.icon_id?"":'<span class="per-badge badge badge'+c.info.icon_id+'"></span>':'<span class="hotListImg basicLevel'+c.info.vip+'"></span>',3==c.info.roled)switch(Number(c.info.live_status)){case 0:c.info.isLive="<span class='per-live per-live-nl'>休息</span>";break;case 1:c.info.isLive="<span class='per-live per-live-ol'>直播</span>";break;default:c.info.isLive=""}3==c.info.roled?c.info.attention='<i class="per-fav"></i><a href="javascript:void(0)" class="per-fav-btn" data-fav="" title="点击关注"><span class="per-fav-btn-title">关注</span></a>':c.info.attention="",c.info.uid==User.UID?c.info.attention="":c.info.attention,c.info.room_url="";var d=Utility.template(rankPanelTmp,c.info);$(a).find(".personContent").html(d),3!=c.info.roled&&($(a).find(".per-video-btn").remove(),$(a).find(".personLink").remove()),$(a).find(".personLoading").remove(),c.info.target=$(a),favoriteHandle(c.info),b&&b(c)}},error:function(){window.console}})})},JSON={isEmpty:function(a){for(var b in a)return!1;return!0},getLength:function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b}},view={},data={},dataInit=function(a){$.ajax({url:"/rank_data",dataType:"json",success:function(b){data.rankData=b,a&&a()},error:function(a){console}})},viewInit=function(){$.extend(view,{$container:$(".J-tab")}),$.each(data.rankData,function(a,b){if(!(a.indexOf("rank_appoint")>-1)){var c="",d="",e=0,f=JSON.getLength(b);for(var g in b){e++;var h=g>0?" num"+e:"",i=""==b[g].headimg||"null"==b[g].headimg?Config.imagePath+"/head_40.png":window.IMG_PATH+"/"+b[g].headimg+"?w=40&h=40",j=1==e||2==e||3==e?'<img class="rank-list_por" src="'+i+'">':"",k="",l="",m=!1,n='href="/'+b[g].uid+Config.liveMode+'" rel="'+b[g].uid+'"';a.indexOf("_exp_")>0&&(m=!0),m||(k="undefined"==typeof b[g].vip||"0"==b[g].vip.toString()?0==Number(b[g].icon_id)?"":'<div class="rank-list_badge badge badge'+b[g].icon_id+'"></div>':'<div class="rank-list_badge hotListImg basicLevel'+b[g].vip+'"></div>',n='rel="'+b[g].uid+'"'),l=m?'<div class="hotListImg AnchorLevel'+b[g].lv_exp+'"></div>':"";var o=g<3&&(Number(b[g].icon_id)>0||Number(b[g].vip)>0)?"rank-list_name__inshort":"";d+="<li>"+(0==g?"":'<div class="rank-list_num'+h+'">'+e+"</div>")+j+"<a "+n+' class="rank-list_name panel-hover"><span class="rank-list_name__in '+o+'">'+b[g].nickname+'</span><div class="personDiv" data-rel="'+b[g].uid+'"><div class="personContent clearfix"><img class="personLoading" src="'+Config.imagePath+'/loading.gif" /></div></div></a>'+k+l+"</li>",f<15?(c+=d,d="",f==Number(g)+1&&(c="<ul class='rank-menu_col'>"+c+"</ul>")):e%15==0&&(c=c+"<ul class='rank-menu_col'>"+d+"</ul>",d="")}$("#"+a).html(c)}}),$.each(data.rankData,function(a,b){if(a.indexOf("rank_appoint")!=-1){var c="",d="",e=0;for(var f in b){if(5==e)break;e++;var g=f>0?" num"+e:"",h=""==b[f].headimg||"null"==b[f].headimg?Config.imagePath+"/head_150.png":window.IMG_PATH+"/"+b[f].headimg+"?w=150&h=150",i='<img class="rank-list-por" src="'+h+'">';d+='<ul class="rank-menu-col"><li><div class="rank-list-num '+g+'">'+i+'<span class="num">'+f+"</span>"+(0==f?'<div class="crown"></div>':"")+'</div><div class="rank-box"><a href="/'+b[f].uid+Config.liveMode+'" rel="'+b[f].uid+'" class="rank-name panel-hover"><span class="rank-list-name">'+b[f].nickname+'</span><div class="personDiv" data-rel="'+b[f].uid+'"><div class="personContent clearfix"><img class="personLoading" src="'+Config.imagePath+'/loading.gif" /></div></div></a><div class="rank-list-dsc">'+(""==b[f].description?"此人好懒，大家帮TA想想写些什么吧。":b[f].description)+"</div></div></li></ul>",c+=d,d=""}$("#"+a).html(c)}})};eventInit=function(){getPanelData(view.$container)},$(function(){dataInit(function(){viewInit(),eventInit()})});