/*! cross - v0.1.2 - 2018-02-05 */Array.prototype.each=function(a){a=a||Function.K;for(var b=[],c=Array.prototype.slice.call(arguments,1),d=0;d<this.length;d++){var e=a.apply(this,[this[d],d].concat(c));null!=e&&b.push(e)}return b},Array.prototype.uniquelize=function(){for(var a=new Array,b=0;b<this.length;b++)a.contains(this[b])||a.push(this[b]);return a},Array.prototype.contains=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return!0;return!1},Array.complement=function(a,b){return Array.minus(Array.union(a,b),Array.intersect(a,b))},Array.intersect=function(a,b){return a.uniquelize().each(function(a){return b.contains(a)?a:null})},Array.minus=function(a,b){return a.uniquelize().each(function(a){return b.contains(a)?null:a})},Array.union=function(a,b){return a.concat(b).uniquelize()},$(function(){var a=function(a,b){$.ajax({url:"/charge/checkCharge",data:{orderId:a},dataType:"json",type:"GET",success:function(a){b&&b(a)},error:function(){}})},b=function(a){$.ajax({url:"/charge/del",type:"POST",data:{lid:a.id},dataType:"json",success:function(b){b.ret?($.tips(b.info),a.target.closest("tr").remove()):$.tips(b.info)},error:function(){$.tips("删除失败")}})};if($(document).on("click",".charge-del",function(){var a={};a.target=$(this),a.id=$(this).data("id"),b(a)}),$(document).on("click",".charge-unknown",function(){var b=$(this).data("tradeno"),c=$.dialog({title:"提示",content:"正在获取状态，请稍等"}).show();a(b,function(a){$.tips(a.msg),c.remove()})}),$("#chargePay").on("click",function(){var b=$(".charge-tips"),c=$("#chargeIpt").val(),d=$("input[name='price']"),e=$(".chargePlat"),f=$(".chargePlat:checked"),g=f.parent("label");$("#chargeIptRadio");if(!d.is(":checked"))return void b.text("请选择要充值的金额");var h=!1;if($.each(e,function(a,b){if($(b).is(":checked")&&$(b).is(":visible"))return h=!0,!1}),0==e.length||!h)return void b.text("请选择充值渠道，若无充值渠道，请联系客服。");var i=d.filter(":checked").val(),j=Number(i)!=-1?i:c,k=window.open();$.ajax({url:"/charge/pay",data:{price:j,vipLevel:f.val(),mode_type:g.data("id")},dataType:"json",type:"POST",success:function(b){if(b.status)$.tips(b.msg);else{var c=$.dialog({title:"支付状态",id:"dialogChargeState",content:"<p>充值金额："+j+"元<br/></p>",onshow:function(){$("#dialogChargeState").on("click",function(){a(b.msg.orderId)})},okValue:"已完成支付",ok:function(){var c=function(){var d=$.dialog({title:"提示",content:"正在获取状态，请稍等"}).show();a(b.msg.orderId,function(a){a.status?$.dialog({title:"提示",content:a.msg,ok:function(){return c(),!1},okValue:"再次向系统确认",cancel:function(){},cancelValue:"关闭"}).show():location.href="/member/charge",d.remove()})};c()}});c.show(),k.location.href=b.msg.gotourl}},error:function(a){}})}),$(".charge-label").on("click",function(){var a=parseInt($(this).find("[name='price']").val(),10),b=[],c=[],d=[],e=$(".charge-box-hz").find("input[type=radio]");if($.each(recharge_money,function(c,d){if(d.recharge_max>=a)return""==$.trim(d.recharge_type)&&(b=[]),$.isArray(d.recharge_type)&&(b=$.merge([],d.recharge_type),$.each(b,function(a,c){b[a]=parseInt(c,10)})),"string"==typeof d.recharge_type&&(b=$.merge([],JSON.parse(d.recharge_type)),$.each(b,function(a,c){b[a]=parseInt(c,10)})),!1}),$.each(e,function(a,b){c.push(parseInt($(b).closest("label").data("id"),10))}),d=Array.intersect(c,b),d.length){for(var f=0;f<d.length;f++)e.each(function(a,b){parseInt($(b).closest("label").data("id"),10)==d[f]?($(b).closest("label").css({display:"inline-block"}),d.shift()):$(b).closest("label").css({display:"none"})});$(".charge-tips").text("")}else $("#chargePlat").find("label").hide(),$(".charge-tips").text("暂时没有充值渠道，请联系客服充值。")}),$("[name='price']").on("click",function(){$(".charge-tips").html("")}),$(".charge-box").on("click","label",function(){var a=$(this).find("input[type=radio]");a.prop("checked")&&($(this).siblings().removeClass("active"),$(this).addClass("active"))}),getLocation("msg")&&$.tips(getLocation("msg")),getLocation("radioprice")){var c=getLocation("radioprice"),d=$("[type=radio][value="+c+"]"),e=$("#chargeIpt");d.length?d.prop("checked",!0):($("#chargeIptRadio").prop("checked",!0),e.val(c))}$("#chargeIptBox").on("click",function(){$("#chargeIpt").focus(),$(".charge-box").find("label").removeClass("active")}),$("#chargeIpt").on("click",function(){$("#chargeIptRadio").prop("checked",!0)}).on("keyup",function(){var a=0,b=$(this).val(),c=$(this).parent("span").siblings(".charge-diamond"),d=$(".charge-tips");$.isNumeric(b)&&parseInt(b,10)>1e5?(a=parseInt(b,10),c.text(10*a+"钻石"),d.text("最多充值100000元")):$.isNumeric(b)&&parseInt(b,10)<10?d.text("最少充值10元"):$.isNumeric(b)&&/^[1-9]\d*$/.test(b)&&parseInt(b,10)>=10&&parseInt(b,10)<=1e5?(a=parseInt(b,10),c.text(10*a+"钻石"),d.text("")):(c.text(""),d.text("不可输入0，小数，负数，字母和特殊符号"))})});