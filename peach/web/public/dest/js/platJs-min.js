/*! cross - v0.1.2 - 2018-02-05 */!function(a){var b="object"==typeof exports&&exports,c="object"==typeof module&&module&&module.exports==b&&module,d="object"==typeof global&&global;d.global!==d&&d.window!==d||(a=d);var e=function(a){this.message=a};e.prototype=new Error,e.prototype.name="InvalidCharacterError";var f=function(a){throw new e(a)},g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h=/[\t\n\f\r ]/g,i=function(a){a=String(a).replace(h,"");var b=a.length;b%4==0&&(a=a.replace(/==?$/,""),b=a.length),(b%4==1||/[^+a-zA-Z0-9\/]/.test(a))&&f("Invalid character: the string to be decoded is not correctly encoded.");for(var c,d,e=0,i="",j=-1;++j<b;)d=g.indexOf(a.charAt(j)),c=e%4?64*c+d:d,e++%4&&(i+=String.fromCharCode(255&c>>(-2*e&6)));return i},j=function(a){a=String(a),/[^\0-\xFF]/.test(a)&&f("The string to be encoded contains characters outside of the Latin1 range.");for(var b,c,d,e,h=a.length%3,i="",j=-1,k=a.length-h;++j<k;)b=a.charCodeAt(j)<<16,c=a.charCodeAt(++j)<<8,d=a.charCodeAt(++j),e=b+c+d,i+=g.charAt(e>>18&63)+g.charAt(e>>12&63)+g.charAt(e>>6&63)+g.charAt(63&e);return 2==h?(b=a.charCodeAt(j)<<8,c=a.charCodeAt(++j),e=b+c,i+=g.charAt(e>>10)+g.charAt(e>>4&63)+g.charAt(e<<2&63)+"="):1==h&&(e=a.charCodeAt(j),i+=g.charAt(e>>2)+g.charAt(e<<4&63)+"=="),i},k={encode:j,decode:i,version:"0.1.0"};if("function"==typeof define&&"object"==typeof define.amd&&define.amd)define(function(){return k});else if(b&&!b.nodeType)if(c)c.exports=k;else for(var l in k)k.hasOwnProperty(l)&&(b[l]=k[l]);else a.base64=k}(this);var RoomTicket=function(){this.init=function(){this.bindTicketRoomEvent()},this.bindTicketRoomEvent=function(){var a=this;$(document).on("click",".ticketRoom",function(b){b.preventDefault();var c=$(this),d={ordTitle:c.find(".username").text(),ordDuration:c.data("duration"),ordPoints:c.data("points"),ordStartTime:c.data("starttime"),ordEndTime:c.data("endtime"),ordRoomId:c.data("roomid"),ordOneToManyId:c.data("onetomany")};a.showBuyTicketDialog(d)})},this.showBuyTicketDialog=function(a){for(var b=a.ordTitle,c=Number(a.ordDuration)/60,d=a.ordPoints,e=a.ordStartTime,f=a.ordEndTime,g=a.ordRoomId,h=a.ordOneToManyId,i=!1,j=0;j<User.MY_TICKET.length;j++)if(User.MY_TICKET[j].id==h){i=!0;break}if(i)return void $.dialog({title:"温馨提示",content:"您已经有该房间门票",ok:function(){location.href="/"+g+"/h5"},okValue:"立即进入",cancel:function(){},cancelValue:"稍后再去"}).show();var k="<div class='ordDialog'><div class='ordDialogContent'><h4>精彩表演，房间爆满</h4><h4>客官快快买票进入吧！</h4><p>主播昵称："+b+"<br/>直播时长："+c+"分钟</br>入场费用："+d+"钻</br>开播时间："+e+"<br/>结束时间："+f+'</p></div><div class=\'ordDialogBottom\'><button type="button" class="btn btnTicketEnter" autofocus="" >立即进入</button><button type="button" class="btn-leave btnTicketLeave" >狠心离开</button></div></div>',l=function(){window.OpenAPI?window.open(window.OpenAPI.link.pay):location.href="/charge/order"},m=function(){window.OpenAPI?window.parent.close():o.remove()},n=!window.OpenAPI,o=$.dialog({title:"精彩一对多",content:k,closeButtonDisplay:n,cancelTextBtn:!0}),p=$.dialog({title:"一对多房间购票",content:"正在通讯，请稍等片刻...",cancel:function(){},cancelValue:"关闭",cancelDisplay:!1});o.show(),$(document).off("click",".btnTicketEnter"),$(document).on("click",".btnTicketEnter",function(){var a=$(this);p.show(),window.OpenAPI||o.remove(),a.prop("disabled",!0),$.ajax({url:"/member/makeUpOneToMore",type:"POST",dataType:"json",data:{rid:g,onetomore:h},success:function(b){p.remove(),1==b.status?$.dialog({title:"通知",content:"购买成功，立即观看！",closeButtonDisplay:!1,ok:function(){location.href="/"+g+"/h5"},okValue:"立即观看"}).show():b.cmd&&"topupTip"==b.cmd?$.dialog({title:"提示",content:b.msg,closeButtonDisplay:!1,okValue:"立即充值",ok:function(){l()},cancelValue:"狠心离开",cancel:function(){}}).show():(a.prop("disabled",!1),$.tips(b.msg))},error:function(){a.prop("disabled",!1),p.remove(),$.tips("购买失败，请联系客服。")}})}),$(document).off("click",".btnTicketLeave"),$(document).on("click",".btnTicketLeave",function(){m()})},this.init()};